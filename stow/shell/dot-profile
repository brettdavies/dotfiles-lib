# Load telemetry settings
if [ -f ~/.telemetry.sh ]; then
    . ~/.telemetry.sh
fi

# Load secrets from ~/.secrets
if [ -f ~/.secrets ]; then
    . ~/.secrets
fi

# Initialize Homebrew shell environment (macOS only)
# This ensures Homebrew PATH is available in all shells (login and interactive)
# Supports both /opt/homebrew (Apple Silicon) and /usr/local (Intel)
if [[ "$OSTYPE" == "darwin"* ]]; then
    # Only set up if not already set (avoid duplicate PATH entries)
    # This prevents issues if .zprofile or .bash_profile already set it up
    if [[ -z "${HOMEBREW_PREFIX:-}" ]]; then
        export HOMEBREW_NO_ENV_HINTS=1
        # Check for brew in standard locations (don't rely on PATH)
        if [ -f /opt/homebrew/bin/brew ]; then
            eval "$(/opt/homebrew/bin/brew shellenv)"
        elif [ -f /usr/local/bin/brew ]; then
            eval "$(/usr/local/bin/brew shellenv)"
        fi
    fi
fi

# Enable background tasks for Claude Code
export ENABLE_BACKGROUND_TASKS=1

# Enable maintaining project working directory
export CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR=1

# Central AI model cache directory
export MODELS_HOME="$HOME/models"

# Create the models directory if it doesn't exist
[ ! -d "$MODELS_HOME" ] && mkdir -p "$MODELS_HOME"

# HuggingFace models
export HF_HOME="$MODELS_HOME/huggingface"
export HUGGINGFACE_HUB_CACHE="$MODELS_HOME/huggingface/hub"
export TRANSFORMERS_CACHE="$MODELS_HOME/huggingface/transformers"

# PyTorch models
export TORCH_HOME="$MODELS_HOME/torch"

# Ollama models
export OLLAMA_MODELS="$MODELS_HOME/ollama"

# Create models directory if it doesn't exist
[ ! -d "$OLLAMA_MODELS" ] && mkdir -p "$OLLAMA_MODELS"

# Stable Diffusion / Diffusers
export DIFFUSERS_CACHE="$MODELS_HOME/diffusers"

# Python package manager cache directories
export PIP_CACHE_DIR="$HOME/.cache/pip"

# Create pip cache directory if it doesn't exist
[ ! -d "$PIP_CACHE_DIR" ] && mkdir -p "$PIP_CACHE_DIR"

# Ensure ~/.local/bin is in PATH for user-installed binaries
# This script adds ~/.local/bin to PATH if not already present, allowing
# locally installed binaries to override system ones and providing a standard
# location for user scripts and tools.
. "$HOME/.local/bin/env"

# Rust/Cargo environment
if [ -f "$HOME/.cargo/env" ]; then
    . "$HOME/.cargo/env"
fi

# Added by LM Studio CLI (lms)
export PATH="$PATH:$HOME/.lmstudio/bin"
# End of LM Studio CLI section

# GitHub PR line comments alias
alias gh-pr-comments='gh api repos/$(gh repo view --json owner,name --jq '"'"'.owner.login + "/" + .name'"'"')/pulls/$1/comments --jq '"'"'.[] | {author: .user.login, body: .body, path: .path, line: .line, position: .position}'"'"''

