# Load telemetry settings
if [ -f ~/.telemetry.sh ]; then
    . ~/.telemetry.sh
fi

# Load secrets from ~/.secrets
if [ -f ~/.secrets ]; then
    . ~/.secrets
fi

# Add Homebrew to PATH (macOS)
# This must be done early so brew command is available for other scripts
if [[ "$OSTYPE" == "darwin"* ]]; then
    export HOMEBREW_NO_ENV_HINTS=1
    # Check for Homebrew in standard locations
    if [ -d "/opt/homebrew/bin" ]; then
        export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"
        # Add Homebrew Python unversioned symlinks (python3, pip3, etc.) to PATH
        # This ensures Homebrew's Python is used instead of system/framework Python
        if [ -d "/opt/homebrew/opt/python@3.12/libexec/bin" ]; then
            export PATH="/opt/homebrew/opt/python@3.12/libexec/bin:$PATH"
        fi
    elif [ -d "/usr/local/bin" ]; then
        # Legacy Homebrew location (Intel Macs)
        export PATH="/usr/local/bin:/usr/local/sbin:$PATH"
        # Add Homebrew Python unversioned symlinks (python3, pip3, etc.) to PATH
        if [ -d "/usr/local/opt/python@3.12/libexec/bin" ]; then
            export PATH="/usr/local/opt/python@3.12/libexec/bin:$PATH"
        fi
    fi
fi

# Enable background tasks for Claude Code
export ENABLE_BACKGROUND_TASKS=1

# Enable maintaining project working directory
export CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR=1

# Central AI model cache directory
export MODELS_HOME="$HOME/models"

# Create the models directory if it doesn't exist
[ ! -d "$MODELS_HOME" ] && mkdir -p "$MODELS_HOME"

# HuggingFace models
export HF_HOME="$MODELS_HOME/huggingface"
export HUGGINGFACE_HUB_CACHE="$MODELS_HOME/huggingface/hub"
export TRANSFORMERS_CACHE="$MODELS_HOME/huggingface/transformers"

# PyTorch models
export TORCH_HOME="$MODELS_HOME/torch"

# Ollama models
export OLLAMA_MODELS="$MODELS_HOME/ollama"

# Create models directory if it doesn't exist
[ ! -d "$OLLAMA_MODELS" ] && mkdir -p "$OLLAMA_MODELS"

# Stable Diffusion / Diffusers
export DIFFUSERS_CACHE="$MODELS_HOME/diffusers"

# Python package manager cache directories
export PIP_CACHE_DIR="$HOME/.cache/pip"

# Create pip cache directory if it doesn't exist
[ ! -d "$PIP_CACHE_DIR" ] && mkdir -p "$PIP_CACHE_DIR"

# Ensure ~/.local/bin is in PATH for user-installed binaries
# This script adds ~/.local/bin to PATH if not already present, allowing
# locally installed binaries to override system ones and providing a standard
# location for user scripts and tools.
. "$HOME/.local/bin/env"

# Rust/Cargo environment
if [ -f "$HOME/.cargo/env" ]; then
    . "$HOME/.cargo/env"
fi

# Added by LM Studio CLI (lms)
export PATH="$PATH:$HOME/.lmstudio/bin"
# End of LM Studio CLI section

# GitHub PR line comments alias
alias gh-pr-comments='gh api repos/$(gh repo view --json owner,name --jq '"'"'.owner.login + "/" + .name'"'"')/pulls/$1/comments --jq '"'"'.[] | {author: .user.login, body: .body, path: .path, line: .line, position: .position}'"'"''
